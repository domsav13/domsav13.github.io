---
layout: post
title: Controls for a 2D Rocket
date: 2025-12-10 11:12:00-0400
description: LQG and model predictive control of a rocket for hovering, landing, and waypoint flight
tags: 
categories: 
thumbnail: assets/img/2drocket.jpg
related_posts: false
---

### Problem Setup and 2D Rocket Dynamics

This project is a exploration of control system design based on the 2D rocket dynamics below, inspired by SpaceX's self-landing rockets.

<div class="row mt-3">
    <div class="col-12 col-md-7 mx-auto mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/2drocket.jpg" class="img-fluid rounded z-depth-1" %}
    </div>
</div>
<div class="caption">
    2D rocket free body diagram
</div>

First, the linear and rotational equations of motion are collected by summing the system's forces and moments:

$$
\begin{aligned}
m\ddot{p}&=f_g+f_t\\
J\ddot{\theta}&=r \times f_t
\end{aligned}
$$

The input to the system is the thrust vector $$ f_t $$, which can be broken into magnitude $$ \rho $$ and angle $$ \phi $$. Therefore, in the rocket body fixed frame, the thrust vector can be expressed as $$ f_t' = \rho\begin{bmatrix}\sin\phi&\cos\phi\end{bmatrix}^T $$. To convert between the body fixed frame and the global frame, a rotation matrix is used with the thrust term in the first equation of motion:

$$
\begin{aligned}
m\ddot{p}&=f_g+\rho\begin{bmatrix}\cos\theta^-\sin\theta\\\sin\theta&\cos\theta\end{bmatrix}\begin{bmatrix}\sin\phi\\\cos\phi\end{bmatrix}\\
&= f_g + \rho\begin{bmatrix}\cos\theta\sin\phi-\sin\theta\cos\phi\\\sin\theta\sin\phi+\cos\theta\cos\phi\end{bmatrix} \\
&= f_g + \rho\begin{bmatrix}\sin(\phi-\theta)\\\cos(\phi-\theta)\end{bmatrix}
\end{aligned}
$$

In the global frame, the gravitational force is constant with $$ g $$ as the acceleration due to gravity: $$ f_g = \begin{bmatrix}0&-mg\end{bmatrix}^T. 

In the body fixed frame, the position of the thruster $$ r $$ is constant assuming the body fixed y-axis points forward. Thus, $$ r = \begin{bmatrix}0&-d\end{bmatrix}^T $$ and the second equation of motion can be rewritten as:

$$
J\ddot{\theta}=\rho d \sin\phi
$$

which is combined with the previous derivations to get the complete set of second order nonlinear dynamics:

$$
\begin{aligned}
m\ddot{p}_x&=\rho \sin(\phi-\theta)\\
m\ddot{p}_y&=\rho \cos(\phi-\theta)-mg\\
J\ddot{\theta}&=\rho d \sin\phi
\end{aligned}
$$

#### Linearization

The states of the system are $$ x = \begin{bmatrix}p_x&p_y&\theta&v_x&v_y&\omega\end{bmatrix}^T $$ where $$ v_x $$, $$ v_y $$, and $$ \omega $$ are the time derivatives of $$ p_x $$, $$ p_y $$, and $$ \theta $$ respectively and the input is $$ u = \begin{bmatrix}\rho&\phi\end{bmatrix}^T $$. To determine the inputs and states $$ (x^*,u^*) $$ such that the rocket hovers at some arbitrary point $$ p_0 = \begin{bmatrix}p_{x0}&p_{y0}\end{bmatrix}^T $$, the following must be true:

$$
\begin{aligned}
\ddot{p}_x&=\ddot{p}_y=\ddot{\theta}=0\\
\dot{p}_x&=\dot{p}_y=\dot{\theta}=0\\
p_x^*&=p_{x0}\\
p_y^*&=p_{y0}
\end{aligned}
$$

The equations of motion become:

$$
\begin{aligned}
0&=\rho^* \sin(\phi^*-\theta^*)\\
0&=\rho^* \cos(\phi^*-\theta^*)-mg\\
0&=\rho^* d \sin\phi^*
\end{aligned}
$$

With $$ \rho > 0 $$, these equations imply $$ \sin(\phi^*-\theta^*) = 0 $$, $$ \sin \phi^*=0 $$, and $$ \rho^*\cos(\phi^*-\theta^*)=mg $$. To guarantee the physically relevant solution with upward thrust, $$ \phi^* = 0 $$, $$ \theta^* = 0 $$, and $$ \rho^* = mg $$. Therefore, the equilibrium state and input for hovering at an arbitrary point $$ p_0 $$ are:

$$
\begin{aligned}
x^*&=\begin{bmatrix}p_{x0}&p_{y0}&0&0&0&0\end{bmatrix}^T\\
u^*&=\begin{bmatrix}\rho^*\\\phi^*\end{bmatrix}=\begin{bmatrix}mg\\0\end{bmatrix}
\end{aligned}
$$

Next, the state space is linearized about the equilibrium by 

$$
\Delta \dot{x} = A \Delta x + B \Delta u
$$

where $$ \Delta x = x - x^* $$ and $$ \Delta u = u - u^* $$. To compute the Jacobians $$ A = \frac{\partial f}{\partial x}|_{(x^*,u^*)} $$ and $$ B = \frac{\partial f}{\partial u}|_{(x^*,u^*)}$$, the full state dynamics are needed:

$$
\dot{x}=f(x,u)=\begin{bmatrix}\dot{p}_x\\\dot{p}_y\\\dot{\theta}\\\dot{v}_x\\\dot{v}_y\\\dot{\omega}\end{bmatrix}=\begin{bmatrix}v_x\\v_y\\\omega\\\frac{\rho}{m}\sin(\phi-\theta)\\\frac{\rho}{m}\cos(\phi-\theta)-g\\\frac{\rho d}{J}\sin\phi\end{bmatrix}
$$

With $$ A_{ij} = \frac{\partial f_i}{\partial x_j} $$ and $$ B_{ik} = \frac{\partial f_i}{\partial u_k} $$ for each state and input, and with values $$ m = 20 $$ kg, $$ J = 4 $$ kgm^2, and $$ d = 0.75 $$ m, the full state matrices are:

$$
A = \begin{bmatrix}0&0&0&1&0&0\\0&0&0&0&1&0\\0&0&0&0&0&1\\0&0&-g&0&0&0\\0&0&0&0&0&0\\0&0&0&0&0&0\end{bmatrix} \quad\quad\quad B = \begin{bmatrix}0&0\\0&0\\0&0\\0&g\\\frac{1}{20}&0\\0&\frac{15g}{4}\end{bmatrix}
$$

The matrix $$ A $$ does not depend on the model parameters, and it is observed that the eigenvalues of $$ A $$ are:

$$
\lambda_1 = \lambda_2 = ... = \lambda_6 = 0
$$

With all eigenvalues lying at the origin, the stability of the equilibrium is not asymptotically stable by definition. Because the eigenvalue at 0 has nontrivial Jordan blocks, the equilibrium is also not Lyapunov stable. Therefore the equilibrium is unstable in the open loop. The open-loop response of the rocket is compared near the equilibrium for both the linearized model and the full nonlinear model. The initial conditions consist of a small perturbation in pitch angle $$ \theta $$ and no contorl input is applied $$ (u=0) $$.

img

The position $$ p_x $$ drifts rapidly in both simulations. Because the rocket is tilted to start, the thrust vector has a constant horizontal component which causes $$ p_x $$ to grow unbounded in both models. This demonstrates the open-loop instability of the hover equilibrium. The main discrepancy in the two simulations appears in the vertical position $$ p_y $$. In the linearized dynamics $$ p_y $$ remains constant since the linearization assumes small angles and treats the thrust as fully canceling gravity. In the nonlinear model, however, the vertical thrust component is $$ mg\cos\theta_0<mg $$ for some initial pitch $$ \theta_0 $$, so the vertical position gradually descends due to a force imbalance.

### Control System Design
